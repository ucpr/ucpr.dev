<!doctype html>
<html>
  <head>
    <title>markdown-rs で front matter の値を参照する</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="markdown-rs で front matter の値を参照する" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="/statics/favicon.ico" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MZHE63WMP3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-MZHE63WMP3');
    </script>
    
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/rust.min.js"></script>

    <script>
hljs.highlightAll();
document.addEventListener("DOMContentLoaded", function() {
  var h1 = document.querySelectorAll('body main h1');
  h1.forEach(function(element) {
    element.classList.add('text-xl','font-bold');
  });

  var h2 = document.querySelectorAll('body main h2');
  h2.forEach(function(element) {
    element.classList.add('text-lg','font-bold', 'py-4');
  });

  var p = document.querySelectorAll('body main p');
  p.forEach(function(element) {
    element.classList.add('text-sm','text-gray-600', 'pb-2');
  });

  var a = document.querySelectorAll('body main a');
  a.forEach(function(element) {
    element.classList.add('text-sm','text-blue-600','hover:text-blue-800','pr-4');
  });

  var ul = document.querySelectorAll('body main ul');
  ul.forEach(function(element) {
    element.classList.add('list-disc','list-outside','pl-4');
  });

  var li = document.querySelectorAll('body main li');
  li.forEach(function(element) {
    element.classList.add('text-sm','text-gray-600', 'pt-1');
  });

  var pre = document.querySelectorAll('body main pre');
  pre.forEach(function(element) {
    element.classList.add('py-4','text-sm');
  });

  var code = document.querySelectorAll('body main code');
  code.forEach(function(element) {
    element.classList.add('hljs');
  });
});
</script>
    <style>
      body {
        font-family: "Noto Sans JP", sans-serif;
        font-optical-sizing: auto;
      }
      
h2:before {
  content: "## ";
}
h3:before {
  content: "### ";
}
h4:before {
  content: "#### ";
}

    </style>
  </head>
  <body class="max-w-xl mx-auto">
    <header class="p-4">
  <div class="container mx-auto flex justify-between items-center">
    <a href="/"><h1 class="text-lg font-bold underline">ucpr.dev</h1></a>
    <nav>
      <ul class="flex space-x-4">
        
          <li><a href="&#x2f;" class="hover:text-gray-300">home</a></li>
        
          <li><a href="&#x2f;about" class="hover:text-gray-300">about</a></li>
        
          <li><a href="&#x2f;articles" class="hover:text-gray-300">articles</a></li>
        
      </ul>
    </nav>
  </div>
</header>

    <main class="p-4">
      
  
    <h1># markdown-rs で front matter の値を参照する</h1><div><h2>はじめに</h2>
<p>markdown ファイルにメタデータを記述できる YAML front matter という仕様があります。この記事では、markdown-rs で front matter の値を取得する方法について説明します。</p>
<h2>前提</h2>
<p>この記事内での使用されているツール、クレートのバージョンはは下記の通りです。</p>
<ul>
<li>rustc
<ul>
<li>1.77.0 (aedd173a2 2024-03-17)</li>
</ul>
</li>
<li>markdown-rs
<ul>
<li>1.0.0-alpha.16</li>
</ul>
</li>
</ul>
<h2>markdown-rs での YAML front matter の取得</h2>
<p>markdown-rs で front matter の値を取得するには AST を取得し、AST から front matter の値を取得します。
AST の取得には <code>markdown::to_mdast</code> 関数を使用します。</p>
<pre><code class="language-rust">const body = &quot;---
title: Test Title
tags:
  - rust
  - test
---&quot;

let tree = markdown::to_mdast(body, config).ok().unwrap();
</code></pre>
<p>そして、AST から front matter の値を取得するために、AST のノードを探索して <code>Node::Yaml</code> の型に一致するものを取得します。
取得できる値は <code>String</code> 型になるので、必要であれば YAML パーサーを使って値をパースしてあげることで front matter に記述された値を取得することができます。</p>
<pre><code class="language-rust">let mut front_matter = String::new();
tree.children().into_iter().for_each(|node| {
    for child in node.iter() {
        match child {
            markdown::mdast::Node::Yaml(yaml) =&gt; {
                front_matter = yaml.value.clone();
            }
            _ =&gt; {}
        }
    }
});
</code></pre>
<h2>TOML 形式で記述された front matter の取得</h2>
<p>markdown-rs では YAML 以外にも TOML  形式の front matter の記述もサポートしており、YAML のときと同じ形で値を取得することができます。
TOML 形式での front matter の記述では、デリミタが <code>+++</code> となります。</p>
<pre><code class="language-rust">const body = &quot;+++
title = \&quot;Test Title\&quot;
tags = [\&quot;rust\&quot;, \&quot;test\&quot;]
+++&quot;

let tree = markdown::to_mdast(body, config).ok().unwrap();
</code></pre>
<p>データの取得は YAML とほぼ同様で、<code>match</code> で <code>Node::Toml</code> にマッチさせて値を取得します。</p>
<pre><code class="language-rust">let mut front_matter = String::new();
tree.children().into_iter().for_each(|node| {
    for child in node.iter() {
        match child {
            markdown::mdast::Node::Toml(toml) =&gt; {
                front_matter = toml.value.clone();
            }
            _ =&gt; {}
        }
    }
});
</code></pre>
<h2>おわりに</h2>
<p>この記事では、markdown-rs で front matter の値を取得する方法について説明しました。
front matter の取得方法についてドキュメントや記事などが殆どなかったのでブログにまとめましたが、 markdown-rs ではテストが充実しており他にも使い方で迷ったりした場合はこちらを参照すると良いかもしれません。</p>
<p>本記事において、異なっている説明や表現がありましたらご連絡ください。</p>
<h2>参考</h2>
<ul>
<li><a href="https://github.com/wooorm/markdown-rs">wooorm/markdown-rs | github.com</a></li>
<li><a href="https://docs.github.com/ja/contributing/writing-for-github-docs/using-yaml-frontmatter">YAML front matter の使用 | docs.github.com</a></li>
<li><a href="https://jekyllrb.com/docs/front-matter/">Front Matter | jekyllrb.com</a></li>
</ul>
</div>
  

    </main>

    <footer class="p-4 text-center">
  <p class="text-sm text-gray-600">
    &copy; 2024 Taichi Uchihara
  </p>
  
  <p class="text-sm text-gray-600">
    このサイトでは Google Analytics を使用しています。
  </p>
  
</footer>
  </body>
</html>